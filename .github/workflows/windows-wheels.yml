name: windows-wheels

on:
  push:            # run on push events
    paths-ignore:  # but ignore everything in the docs subfolder
      - 'docs/**'
      - 'src/gui*/**'
      - 'src/netedit/**'
      - 'tests/netedit/**'
    branches:
      - '**'
    tags:
      - '*'
  pull_request:    # run on pull requests
    paths-ignore:  # but ignore everything in the docs subfolder
      - 'docs/**'
  workflow_dispatch:
  schedule:
    - cron:  '5 1 * * *'

jobs:
  call-cibuildwheel:
    uses: ./.github/workflows/cibuildwheel.yml
    with:
      os: "windows-latest"

  check-dependencies:
    runs-on: windows-latest
    strategy:
      fail-fast: false
      matrix:
        python_version: [3.9, '3.10', 3.11, 3.12, 3.13, 3.14]

    steps:
    - name: Downloading Wheels artifact
      uses: actions/download-artifact@v7
      with:
        path: python-wheels
        merge-multiple: true

    - name: Configuring Python
      uses: actions/setup-python@v6
      with:
        python-version: ${{ matrix.python_version }}

    - name: Installing libsumo
      run: |
        python -m pip install --no-index -f python-wheels libsumo
        python -c "import libsumo; print(libsumo.__file__)"

    - name: Running dependency checker
      if: github.event_name == 'schedule'
      run: |
          Invoke-WebRequest -Uri https://github.com/lucasg/Dependencies/releases/download/v1.11.1/Dependencies_x64_Release_.without.peview.exe.zip -OutFile Dependencies.zip
          7z x -oDependencies Dependencies.zip
          $env:PATH += ";" + $env:SUMO_HOME + "\bin"
          python -c "import libsumo, subprocess; subprocess.call(['Dependencies\\Dependencies.exe', '-modules', '-depth', '2', libsumo.__file__.replace('__init__.py', '_libsumo.pyd')])"
